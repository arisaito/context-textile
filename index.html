<!DOCTYPE html>
<html lang="jp">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>textile</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css?family=Roboto&display=swap"
      rel="stylesheet"
    />
    <!-- We've included a slightly modified version of A-Frame, which fixes some polish concerns -->
    <script src="//cdn.8thwall.com/web/aframe/8frame-0.8.2.min.js"></script>

    <!-- XR Extras - provides utilities like load screen, almost there, and error handling.
         See github.com/8thwall/web/xrextras -->
    <script src="//cdn.8thwall.com/web/xrextras/xrextras.js"></script>

    <!-- 8thWall Web - Replace the app key here with your own app key -->
    <script
      async
      src="//apps.8thwall.com/xrweb?appKey=jYZU3acZmXYTem0Cv4yHsKQOHlFji0vYM22qbOZyeQXJUyzgkkkN5thXfMvIQ27hme9XTp"
    ></script>
    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous"
    ></script>

    <!-- other library -->
    <script src="https://rawgit.com/protyze/aframe-curve-component/master/dist/aframe-curve-component.min.js"></script>
    <script src="https://rawgit.com/protyze/aframe-alongpath-component/master/dist/aframe-alongpath-component.min.js"></script>
    <script src="https://wizgrav.github.io/aframe-effects/dist/aframe-effects.js"></script>
  </head>
  <body>
    <!-- 2D overlay UI can be done in HTML -->
    <div id="overlay">
      <div id="loadingScreen">
        <h3>loading...</h3>
      </div>
    </div>

    <!-- Add the 'xrweb' attribute to your scene to make it an 8th Wall Web A-FRAME scene. -->
    <a-scene
      xrweb="disableWorldTracking: true"
      antialias="true"
      xrextras-almost-there
      xrextras-runtime-error
      loading-screen
    >
      <a-assets></a-assets>

      <!-- alongpath -->
      <a-curve id="track1">
        <a-curve-point position="0 0 0"></a-curve-point>
        <a-curve-point position="0 0 27"></a-curve-point>
        <a-curve-point position="0 0 27"></a-curve-point>
        <a-curve-point position="0 0 0"></a-curve-point>
        <a-curve-point position="0 0 0"></a-curve-point>
      </a-curve>

      <a-camera
        position="0 0 0"
        raycaster="objects: .cantap"
        cursor="fuse: false; rayOrigin: mouse;"
        alongpath="curve: #track1; loop: true; dur: 40000; delay: 10000; easing: easeInOutCubic;"
      ></a-camera>

      <!-- Light -->
      <a-entity
        light="type: directional;
               castShadow: true;
               intensity: 0.8;
               shadowCameraTop: 7;
               shadowMapHeight: 1024;
               shadowMapWidth: 1024;"
        position="1 4.3 2.5"
      >
      </a-entity>
      <a-entity
        light="type: directional; castShadow: false; intensity: 0.5;"
        position="-0.8 3 1.85"
      >
      </a-entity>

      <a-light type="ambient" intensity="1"></a-light>

      <a-entity xrextras-named-image-target="name: model-target">
        <a-entity
          animation="easing: linear; property:rotation; dur:5000; to:0 360 0; loop: true;"
        >
          <a-icosahedron
            xrextras-one-finger-rotate
            material="roughness: 0.8; metalness: 0.2; color: #00EDAF;"
            shadow
          >
          </a-icosahedron>
        </a-entity>

        <a-sky
          id="fade-sky"
          color="black"
          attribute="material.opacity"
          begin="fade"
          to="0"
          scale="0.002 0.002 0.002"
          positon="0 1 0"
        ></a-sky>
      </a-entity>
    </a-scene>
    <script>
      // Basic example of controlling the loading screen
      AFRAME.registerComponent("loading-screen", {
        init: function() {
          const scene = this.el.sceneEl;
          scene.addEventListener("realityready", () => {
            // loadingScreen.style.display = "none";
            $(loadingScreen).fadeTo("slow", 0);
          });

          scene.addEventListener("realityerror", () => {
            loadingScreen.textContent = "An error has occurred.";
          });

          scene.addEventListener("camerastatuschange", event => {
            if (event.detail.status == "failed") {
              loadingScreen.textContent = "Camera permissions were denied.";
            }
          });
        }
      });
      AFRAME.registerComponent("registerevents", {
        init: function() {
          var marker = this.el;

          marker.addEventListener("markerFound", function() {
            var markerId = marker.id;
            var sky = document.getElementById("fade-sky");
            $(sky).fadeIn("slow");
          });
        }
      });
    </script>
  </body>
</html>
